import{t as Q,ad as W,O as X,_ as tt}from"./index.ddc9b962.js";/* empty css              *//* empty css              *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               */import{d as et,j as S,r as at,c as ot,o as st,aY as nt,c0 as lt,c1 as rt,bY as it,bS as ut,bI as dt,C as h,D as v,aI as n,aH as r,aM as p,aN as m,G as f,u as ct,a$ as pt,b0 as mt,aK as ft,aJ as gt,aE as _t,n as F,bc as bt,bk as St,b$ as ht,bh as wt,b8 as yt,bG as Dt,bK as vt,bO as Ft,bm as It,bn as Tt}from"./arco.13f9ef32.js";import{e as w,g as I,h as c,b as T,s as y}from"./serial.d615852e.js";import{u as At}from"./loading.7d726da5.js";import{I as A}from"./index.9cfeeec2.js";import{S as C}from"./dep-71c4f289.006619aa.js";import{T as Ct}from"./index.8b0d8b31.js";import"./chart.5acd6cf6.js";import"./vue.eb9ee7d7.js";import"./index.8c0898cc.js";import"./form-model.08118f5b.js";import"./slot.dfa2827f.js";const Et=_=>(It("data-v-2a117bfe"),_=_(),Tt(),_),xt={class:"container"},kt={style:{"text-align":"center"}},Bt=["src"],Ut=Et(()=>f("br",null,null,-1)),Ot={style:{width:"100%"}},qt=["innerHTML"],Nt={name:"Sat"},Rt=et({...Nt,setup(_){const{loading:E,setLoading:g}=At(!0),u=Q();S(null),S(null),S(null);const a=at({uuid:"",qrcode:"",visible:!1,showHide:0,status:"\u70B9\u51FB\u5199\u5165\u6309\u94AE\u5199\u5165\u536B\u661F\u6570\u636E\u5230\u8BBE\u5907<br/><br/>",sat:"",satData:[],lng:0,lat:0,alt:0,tx:0,rx:0,txTone:0,rxTone:0,CTCSSOption:[0,67,69.3,71.9,74.4,77,79.7,82.5,85.4,88.5,91.5,94.8,97.4,100,103.5,107.2,110.9,114.8,118.8,123,127.3,131.8,136.5,141.3,146.2,151.4,156.7,159.8,162.2,165.5,167.9,171.3,173.8,177.3,179.9,183.5,186.2,189.9,192.8,196.6,199.5,203.5,206.5,210.7,218.1,225.7,229.1,233.6,241.8,250.3,254.1],pass:void 0,passOption:[],dt:"",timer:void 0,passCustom:void 0,dtCustom:void 0,freqDb:[],selfSatModal:!1,selfSatInfo:"",satsData:[]}),x=t=>{const{row:e}=t;return e.status!==2},k=S(),B=ot(()=>[{title:"\u536B\u661F\u540D\u79F0",colKey:"satName"},{title:"\u4E0A\u884C\u9891\u7387",colKey:"txFreq",align:"left",edit:{component:A,props:{clearable:!0,autofocus:!0},validateTrigger:"change",on:t=>({onBlur:()=>{console.log("\u5931\u53BB\u7126\u70B9",t)},onEnter:e=>{var o;(o=e==null?void 0:e.e)==null||o.preventDefault(),console.log("onEnter",e)}}),abortEditOnEvent:["onEnter"],onEdited:t=>{console.log(t);const e=[...a.satsData];e.splice(t.rowIndex,1,t.newRowData),a.satsData=e,console.log("Edit firstName:",t)},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!0}},{title:"\u4E0A\u884C\u4E9A\u97F3",colKey:"txTone",edit:{component:C,props:{clearable:!0,options:a.CTCSSOption.map(t=>({label:t,value:t}))},on:t=>({onChange:e=>{console.log("status changed",t,e)}}),onEdited:t=>{a.satsData.splice(t.rowIndex,1,t.newRowData),console.log("Edit Framework:",t)}}},{title:"\u4E0B\u884C\u9891\u7387",colKey:"rxFreq",align:"left",edit:{component:A,props:{clearable:!0,autofocus:!0},validateTrigger:"change",on:t=>({onBlur:()=>{console.log("\u5931\u53BB\u7126\u70B9",t)},onEnter:e=>{var o;(o=e==null?void 0:e.e)==null||o.preventDefault(),console.log("onEnter",e)}}),abortEditOnEvent:["onEnter"],onEdited:t=>{console.log(t);const e=[...a.satsData];e.splice(t.rowIndex,1,t.newRowData),a.satsData=e,console.log("Edit firstName:",t)},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!0}},{title:"\u4E0B\u884C\u4E9A\u97F3",colKey:"rxTone",edit:{component:C,props:{clearable:!0,options:a.CTCSSOption.map(t=>({label:t,value:t}))},on:t=>({onChange:e=>{console.log("status changed",t,e)}}),onEdited:t=>{a.satsData.splice(t.rowIndex,1,t.newRowData),console.log("Edit Framework:",t)}}}]);st(async()=>{try{if(sessionStorage.getItem("satFrequenciesRst"))a.freqDb=JSON.parse(sessionStorage.getItem("satFrequenciesRst")||"[]");else{const t=await(await fetch("https://github.jobcher.com/gh/https://raw.githubusercontent.com/palewire/ham-satellite-database/main/data/amsat-active-frequencies.json")).text();a.freqDb=JSON.parse(t),sessionStorage.setItem("satFrequenciesRst",t)}}catch{}a.timer=setInterval(()=>{a.dt=new Date().toLocaleString(),localStorage.setItem("myLng",a.lng.toString()),localStorage.setItem("myLat",a.lat.toString()),localStorage.setItem("myAlt",a.alt.toString())},1e3)}),nt(()=>{try{clearInterval(a.timer)}catch{}});const U=async()=>{if(u.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}g(!0),await w(u.connectPort),await D(),await I(u.connectPort),g(!1)},D=async()=>{var o;const t=a.dtCustom?new Date(a.dtCustom):new Date,e=[...c(parseInt(t.getUTCFullYear().toString().substring(2,4)).toString(16)),...c((t.getUTCMonth()+1).toString(16)),...c(t.getUTCDate().toString(16)),...c(t.getUTCHours().toString(16)),...c(t.getUTCMinutes().toString(16)),...c(t.getUTCSeconds().toString(16))];await T(u.connectPort,11168,new Uint8Array(e),6,(o=u.configuration)==null?void 0:o.uart)},O=async t=>{const e=a.satData.find(o=>o.name==t);if(e&&e.path){a.status+="<br/>\u536B\u661F\u53C2\u6570\uFF1A<br/>",e.path.map(s=>{a.status+=s+"<br/>"});let o=!1;a.freqDb.map(s=>{e.path[1].split(" ")[1]==s.norad_id&&s.mode.indexOf("FM")!=-1&&(console.log(s),o=!0,a.tx=s.uplink?parseFloat(s.uplink.split("/")[0]):0,a.rx=s.downlink?parseFloat(s.downlink.split("/")[0]):0,a.txTone=parseFloat(a.CTCSSOption.reduce((l,d)=>s.mode.indexOf(d)!=-1?d:l)))}),o||(a.tx=0,a.rx=0,a.txTone=0,a.rxTone=0),a.satsData.push({satName:t,line:e.path,txFreq:a.tx,txTone:a.txTone,rxFreq:a.rx,rxTone:a.rxTone}),console.log(a.satsData)}F(()=>{const o=document==null?void 0:document.getElementById("statusArea");o&&(o.scrollTop=o==null?void 0:o.scrollHeight)})};(async()=>{g(!0);let t="";sessionStorage.getItem("satRst")?t=sessionStorage.getItem("satRst")||"":(t=await(await fetch("https://celestrak.org/NORAD/elements/amateur.txt")).text(),sessionStorage.setItem("satRst",t));const e=t.split(/\r?\n/),o=[];let s={};for(let l=0;l<e.length;l++)Number.isNaN(parseInt(e[l].substring(0,1)))?(s.name&&s.name!=""&&(o.push(s),s={}),s.name=e[l]):(s.path||(s.path=[]),s.path.push(e[l]));a.satData=o,g(!1)})();const q=async()=>{const t=await(await fetch("https://k5.vicicode.cn/api/lol",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({func:1,uuid:a.uuid})})).json(),e=JSON.parse(t.cache);e.length>=3&&(a.lng=e[0],a.lat=e[1],a.alt=e[2])},N=async(t=0,e)=>{var o;await w(u.connectPort);for(let s=t;s<e.length+t;s+=128)await T(u.connectPort,s,e.slice(s-t,s-t+128),128,(o=u.configuration)==null?void 0:o.uart),a.status=a.status+"\u5199\u5165\u8FDB\u5EA6\uFF1A"+((s-t)/e.length*100).toFixed(1)+"%<br/>",F(()=>{const l=document==null?void 0:document.getElementById("statusArea");l&&(l.scrollTop=l==null?void 0:l.scrollHeight)});a.status=a.status+"\u5199\u5165\u8FDB\u5EA6\uFF1A100.0%<br/>"},R=async()=>{if(u.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}g(!0),await w(u.connectPort);let t=new Uint8Array(160*45);for(let e=0;e<a.satsData.length;e++){const o=a.satsData[e];t.set(y(o.satName).subarray(0,9),e*160),t.set(y(o.line[0]).subarray(0,69),e*160+9),t.set(y(o.line[1]).subarray(0,69),e*160+9+69);const s=new Uint8Array(2);o.txTone&&o.txTone>0&&s.set(c(parseInt((o.txTone*10).toFixed(0)).toString(16)).subarray(0,2)),t.set(s,e*160+9+69+69);const l=new Uint8Array(2);o.rxTone&&o.rxTone>0&&l.set(c(parseInt((o.rxTone*10).toFixed(0)).toString(16)).subarray(0,2)),t.set(l,e*160+9+69+69+2);const d=new Uint8Array(4);d.set(c(parseInt((o.txFreq*1e6/10).toFixed(0)).toString(16))),t.set(d,e*160+9+69+69+2+2);const b=new Uint8Array(4);b.set(c(parseInt((o.rxFreq*1e6/10).toFixed(0)).toString(16))),t.set(b,e*160+9+69+69+2+2+4)}await N(123392,t),await D(),await I(u.connectPort),g(!1)},$=t=>!!new RegExp("^(https?:\\/\\/)?((([a-zA-Z\\d]([a-zA-Z\\d-]*[a-zA-Z\\d])*)\\.)+[a-zA-Z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-zA-Z\\d%_.~+]*)*(\\?[;&a-zA-Z\\d%_.~+=-]*)?(\\#[-a-zA-Z\\d_]*)?$","i").test(t),M=async()=>{$(a.selfSatInfo)&&(a.selfSatInfo=await(await fetch(a.selfSatInfo)).text());const t=(a.selfSatInfo+`
`).split(/\r?\n/),e=[];let o={};for(let s=0;s<t.length;s++)Number.isNaN(parseInt(t[s].substring(0,1)))?(o.name&&o.name!=""&&(e.push(o),o={}),o.name=t[s]):(o.path||(o.path=[]),o.path.push(t[s]));a.satData=e.concat(a.satData),a.selfSatInfo=""};return(t,e)=>{const o=lt,s=bt,l=W,d=St,b=rt,V=X,H=ht,L=it,z=wt,K=Ct,P=yt,Y=Dt,Z=ut,j=dt,J=vt,G=Ft;return h(),v("div",xt,[n(s,{width:"650px",visible:a.selfSatModal,"onUpdate:visible":e[1]||(e[1]=i=>a.selfSatModal=i),onOk:M},{title:r(()=>[p(m(t.$t("sat.selfSatInfo")),1)]),default:r(()=>[f("div",null,[n(o,{modelValue:a.selfSatInfo,"onUpdate:modelValue":e[0]||(e[0]=i=>a.selfSatInfo=i),style:{height:"120px"},placeholder:`ISS (ZARYA)             \r
  1 25544U 98067A   24320.36274227  .00015569  00000+0  28188-3 0  9999\r
  2 25544  51.6413 286.4173 0007936 217.3657 298.3197 15.49809951481990`},null,8,["modelValue"])])]),_:1},8,["visible"]),n(s,{visible:a.visible,"onUpdate:visible":e[2]||(e[2]=i=>a.visible=i),onOk:q,"ok-text":t.$t("tool.scaned")},{title:r(()=>[p(m(t.$t("tool.scanqr")),1)]),default:r(()=>[f("div",kt,[f("img",{src:a.qrcode},null,8,Bt),Ut,p(" "+m(t.$t("tool.scannotice")),1)])]),_:1},8,["visible","ok-text"]),n(l,{items:[t.$t("menu.list"),t.$t("menu.satellite2")]},null,8,["items"]),n(G,{gutter:20,align:"stretch"},{default:r(()=>[n(J,{span:24},{default:r(()=>[n(j,{class:"general-card",title:t.$t("menu.satellite2")+t.$t("global.onStart")},{default:r(()=>[n(Z,{loading:ct(E),style:{width:"100%"},tip:"\u6B63\u5728\u5904\u7406 ..."},{default:r(()=>[n(d,{"label-col-style":{width:"25%"},field:"dt",label:t.$t("tool.brtime"),onClick:e[3]||(e[3]=()=>{a.showHide+=1})},{default:r(()=>[p(m(a.dt),1)]),_:1},8,["label"]),pt(n(d,{"label-col-style":{width:"25%"},field:"dtCustom",label:"\u81EA\u5B9A\u4E49\u65F6\u95F4"},{default:r(()=>[f("div",null,[n(b,{style:{width:"220px",margin:"0 24px 24px 0"},"show-time":"","time-picker-props":{defaultValue:"00:00:00"},format:"YYYY-MM-DD HH:mm:ss",modelValue:a.dtCustom,"onUpdate:modelValue":e[4]||(e[4]=i=>a.dtCustom=i)},null,8,["modelValue"]),p(" \xA0\xA0"),n(V,{size:"small",theme:"success",onClick:U},{default:r(()=>[p("\u5199\u5165\u65F6\u95F4\u5230\u53F0\u7AD9")]),_:1})])]),_:1},512),[[mt,a.showHide>=5]]),n(d,{"label-col-style":{width:"25%"},field:"sat",label:t.$t("tool.selectSatellite")},{default:r(()=>[f("div",Ot,[n(L,{modelValue:a.sat,"onUpdate:modelValue":e[5]||(e[5]=i=>a.sat=i),onChange:O,placeholder:t.$t("tool.selectSatellite")+"...","allow-search":"","allow-clear":""},{default:r(()=>[(h(!0),v(ft,null,gt(a.satData,i=>(h(),_t(H,{key:i.name,value:i.name},{default:r(()=>[p(m(i.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","placeholder"]),n(z,{onClick:e[6]||(e[6]=()=>{a.selfSatModal=!0}),style:{"margin-top":"10px"}},{default:r(()=>[p(m(t.$t("sat.addSelfSat")),1)]),_:1})])]),_:1},8,["label"]),n(d,{"label-col-style":{width:"25%"},field:"sat",label:""},{default:r(()=>[n(K,{ref_key:"tableRef",ref:k,"row-key":"key",columns:B.value,data:a.satsData,"editable-cell-state":x,bordered:"","lazy-load":""},null,8,["columns","data"])]),_:1}),n(d,{"label-col-style":{width:"25%"},label:""},{default:r(()=>[n(P,{type:"primary",onClick:R},{default:r(()=>[p(m(t.$t("tool.writeData")),1)]),_:1})]),_:1}),n(Y),f("div",{id:"statusArea",style:{height:"20em","background-color":"var(--color-bg-3)",color:"var(--color-text-3)",overflow:"auto",padding:"20px"},innerHTML:a.status},null,8,qt)]),_:1},8,["loading"])]),_:1},8,["title"])]),_:1})]),_:1})])}}});const re=tt(Rt,[["__scopeId","data-v-2a117bfe"]]);export{re as default};
