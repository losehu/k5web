import{v as L,t as E,ad as D,_ as M}from"./index.518a6c15.js";/* empty css              *//* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               */import{d as N,j as P,r as T,w as x,aY as $,b3 as K,bT as U,bI as j,C as f,D as v,aI as a,aH as o,aM as r,G as i,aN as _,aK as H,aJ as Z,aE as G,c3 as J,b7 as F,bh as Y,bf as q,b8 as z,bV as O,bm as Q,bn as R,n as W}from"./arco.13f9ef32.js";import{n as X,e as ee,o as te}from"./serial.5c81571b.js";import"./chart.5acd6cf6.js";import"./vue.eb9ee7d7.js";const I=c=>(Q("data-v-3b8129ee"),c=c(),R(),c),ne={class:"container"},se={style:{display:"flex","align-items":"center",margin:"10px"}},ae=I(()=>i("span",null,"\u547C\u53F7\uFF1A",-1)),oe=I(()=>i("span",null,"\u8BBE\u5907\u53F7\uFF1A",-1)),re={style:{height:"500px",border:"1px solid #eee"}},ie={style:{display:"flex"}},le={style:{width:"100px","text-align":"right","margin-right":"10px"}},de={style:{"margin-left":"10px"}},ce={name:"Chat"},ue=N({...ce,setup(c){L.exports.useI18n();const u=E(),p=P(null),e=T({sendInput:"",msgList:[],callsign:sessionStorage.getItem("callsign")||"",devid:parseInt(sessionStorage.getItem("devid")||"0"),connect:!1,reader:null,startChat:"\u5F00\u59CB\u804A\u5929"});x(()=>e.callsign,(n,t)=>{sessionStorage.setItem("callsign",n)}),x(()=>e.devid,(n,t)=>{sessionStorage.setItem("devid",n.toString())}),$(()=>{e.connect&&e.reader.releaseLock()});const b=n=>/^[A-Z]{1,2}\d{1,2}[A-Z]{1,3}$/.test(n),y=()=>{W(()=>{p.value&&(p.value.$el.children[0].children[0].children[0].scrollTop=p.value.$el.children[0].children[0].children[0].scrollHeight)})},C=()=>{F.error("\u656C\u8BF7\u671F\u5F85")},h=async()=>{if(e.sendInput.trim()!=""){if(!b(e.callsign.trim())){F.error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u547C\u53F7");return}console.log(e.callsign.trim()+":"+e.devid+":"+e.sendInput.trim()),X(u.connectPort,e.callsign.trim()+":"+e.devid+":"+e.sendInput.trim()),e.msgList.push({callsign:e.callsign.trim(),devid:e.devid,content:e.sendInput.trim()}),e.sendInput="",y()}},S=async()=>{if(e.connect)e.connect=!1,e.reader.releaseLock(),e.startChat="\u5F00\u59CB\u804A\u5929";else{if(u.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}await ee(u.connectPort),e.reader=te(u.connectPort),A(e.reader),e.startChat="\u65AD\u5F00\u804A\u5929",e.connect=!0}},A=async n=>{let t="";const g=new TextDecoder;for(;;)try{const{value:l,done:m}=await n.read();if(m)break;let d=g.decode(l,{stream:!0});d=d.trim(),t+=d,console.log(t)}catch{break}n.releaseLock()};return(n,t)=>{const g=D,l=Y,m=q,d=K,k=z,w=O,B=U,V=j;return f(),v("div",ne,[a(g,{items:[n.$t("menu.list"),n.$t("menu.flash")]},null,8,["items"]),a(V,{class:"general-card"},{title:o(()=>[r(" \u3010\u5F00\u53D1\u4E2D\u3011\u65E0\u7EBF\u7535\u804A\u5929\uFF08\u9700\u4F7F\u7528"),a(l,{onClick:C},{default:o(()=>[r("\u8FD9\u4E2A")]),_:1}),r("\u56FA\u4EF6\uFF09 ")]),default:o(()=>[i("div",se,[ae,a(m,{modelValue:e.callsign,"onUpdate:modelValue":t[0]||(t[0]=s=>e.callsign=s),style:{width:"200px !important"}},null,8,["modelValue"]),r(" \xA0\xA0\xA0 "),oe,a(d,{min:0,max:15,modelValue:e.devid,"onUpdate:modelValue":t[1]||(t[1]=s=>e.devid=s),style:{width:"200px !important"}},null,8,["modelValue"]),r(" \xA0\xA0\xA0 "),a(k,{onClick:S,type:"primary"},{default:o(()=>[r(_(e.startChat),1)]),_:1})]),i("div",re,[a(B,{"max-height":500,bordered:!1,ref_key:"msgList",ref:p},{empty:o(()=>[]),default:o(()=>[(f(!0),v(H,null,Z(e.msgList,s=>(f(),G(w,null,{default:o(()=>[i("div",ie,[i("div",le,_(s.callsign)+"("+_(s.devid.toString().padStart(2,"0"))+")",1),r(" > "),i("div",de,_(s.content),1)])]),_:2},1024))),256))]),_:1},512)]),a(m,{disabled:!e.connect,modelValue:e.sendInput,"onUpdate:modelValue":t[2]||(t[2]=s=>e.sendInput=s),onKeyup:J(h,["enter"])},{append:o(()=>[a(l,{disabled:!e.connect,onClick:h},{default:o(()=>[r("\u53D1\u9001")]),_:1},8,["disabled"])]),_:1},8,["disabled","modelValue"])]),_:1})])}}});const Se=M(ue,[["__scopeId","data-v-3b8129ee"]]);export{Se as default};
